##############################################################################
# Copyright (c) 2016-19, Lawrence Livermore National Security, LLC and
# radiuss-ci project contributors. See the COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################

####
# This is the share configuration of jobs for quartz

####
# In pre-build phase, allocate a node for builds
.on_quartz:
  tags:
    - shell
    - quartz
  rules:
    - if: '$CI_COMMIT_BRANCH =~ /_qnone/ || $PROJECT_CI_QUARTZ == "OFF"' #run except if ...
      when: never
    - if: '$CI_JOB_NAME =~ /release_resources/'
      when: always
    - when: on_success

####
# Generic qwartz build job, extending build script
.build_on_quartz:
  stage: q_build
  extends: [.build_toss_3_x86_64_ib_script, .on_quartz]

.build_on_quartz_advanced:
  extends: [.build_on_quartz, .advanced_pipeline]

####
# Generic qwartz test job, extending test script
.test_on_quartz:
  stage: q_test
  extends: [.test_toss_3_x86_64_ib_script, .on_quartz]

.test_on_quartz_advanced:
  extends: [.test_on_quartz, .advanced_pipeline]
